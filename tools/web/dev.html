<html>
    <head>
        <style>
            body { 
                background-color: #333; 
            }
            #code-container {
                /*float: left;*/
                position: absolute;
                left: 10px;
                top: 10px;
            }
            #code {
                width: 600px;
                margin-bottom: 5px;
                border: 1px solid #666;
            }
            #game-container {
                /*float: right;*/
                position: absolute;
                left: 620px;
                top: 10px;
            }
            #game-frame {
                width: 900px;
                height: 600px;
                border: 1px solid #666;
            }
        </style>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.52.2/codemirror.min.css"></link>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.52.2/theme/lesser-dark.css"></link>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.52.2/codemirror.min.js"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.52.2/mode/vbscript/vbscript.min.js"></script>
    </head>
    <body>
        <div id="code-container">
            <div id="code"></div>
            <button onclick="postTest()">Run Program</button>
        </div>
        <div id="game-container">
            <iframe id="game-frame" frameborder="0"></iframe>
        </div>
    </body>
    <script language="javascript" src="gx.js"></script>
    <script language="javascript" src="qb64.js"></script>
    <script language="javascript" src="game.js"></script>
    <script language="javascript">
        var editor = CodeMirror(document.querySelector("#code"), {
            lineNumbers: true,
            tabSize: 2,
            value: "",
            module: "vbscript",
            theme: "lesser-dark",
            height: "auto",
            extraKeys: {
                "Tab": function(cm) {
                    cm.replaceSelection("   ", "end");
                }
            }
        });
        editor.setSize(600, 600);

        function postTest() {
            var xhr = new XMLHttpRequest();
            xhr.open("POST", "qb2js");
            xhr.setRequestHeader("Content-Type", "application/json");
            xhr.send(editor.getValue());
            
            document.getElementById("game-frame").src = "test.html";
        }

        fetch("game.bas").then(response => response.text()).then( data => {
            editor.setValue(data);
        });

        window.onresize = function() {
            //alert("resize");
            var f = document.getElementById("game-frame");
            f.style.width = (window.innerWidth - 635) + "px";
            f.style.height = (window.innerHeight - 50) + "px";

            editor.setSize(600, window.innerHeight - 50);
        }
        window.onresize();
    </script>
</html>